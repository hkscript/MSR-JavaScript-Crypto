//*******************************************************************************
//
//    Copyright 2020 Microsoft
//
//    Licensed under the Apache License, Version 2.0 (the "License");
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
//
//        http://www.apache.org/licenses/LICENSE-2.0
//
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an "AS IS" BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.
//
//*******************************************************************************
"use strict";var msrCryptoVersion="1.6.4";!function(e,r){"function"==typeof define&&define.amd?define([],function(){return e.msrCrypto=r(e)}):"object"==typeof exports?module.exports=r(e):e.msrCrypto=r(e)}(this,function(e){e=e||{};return function(){var r={register:function(e,t,n){r[e]||(r[e]={});var o=r[e];o[t]||(o[t]=n)},exists:function(e,t){return!!r[e]&&!!r[e][t]}},t=function(){if("undefined"!=typeof document)try{throw new Error}catch(r){if(r.stack){var e=/\w+:\/\/(.+?\/)*.+\.js/.exec(r.stack);return e&&e.length>0?e[0]:null}}else if("undefined"!=typeof self)return self.location.href;return null}(),n="undefined"!=typeof Worker,o="function"==typeof importScripts&&self instanceof WorkerGlobalScope,a=!1,i="undefined"!=typeof ArrayBuffer,u=(function(){try{Object.defineProperty({},"oncomplete",{})}catch(e){return!1}}(),!1),s={},l=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(r){for(r=r.replace(/-/g,"+").replace(/_/g,"/");r.length%4!=0;)r+="=";var t,n,o,a,i,u,s,l=[];for(r=r.replace(/[^A-Za-z0-9\+\/\=]/g,""),s=0;s<r.length;s+=4)t=e.indexOf(r.charAt(s))<<2|(a=e.indexOf(r.charAt(s+1)))>>4,n=(15&a)<<4|(i=e.indexOf(r.charAt(s+2)))>>2,o=(3&i)<<6|(u=e.indexOf(r.charAt(s+3))),l.push(t),64!==i&&l.push(n),64!==u&&l.push(o);return l}function t(e){return Object.prototype.toString.call(e).slice(8,-1)}function n(e){return[e>>>24&255,e>>>16&255,e>>>8&255,255&e]}function o(e){if(!e)return[];if(e.pop)return e;if("ArrayBuffer"===t(e)?e=new Uint8Array(e):e.BYTES_PER_ELEMENT>1&&(e=new Uint8Array(e.buffer)),1===e.length)return[e[0]];if(e.length<65536)return Array.apply(null,e);for(var r=new Array(e.length),n=0;n<e.length;n++)r[n]=e[n];return r}return{consoleLog:function(e){"console"in self&&"log"in console&&console.log(e)},toBase64:function(r,n){var a=t(r);if("Array"!==a&&"Uint8Array"!==a&&"ArrayBuffer"!==a)throw new Error("invalid input");var i,u,s,l,c,f,h,g,p="",y=o(r);for(n||(n=!1),g=0;g<y.length;g+=3)l=(i=y[g])>>2,c=(3&i)<<4|(u=y[g+1])>>4,f=(15&u)<<2|(s=y[g+2])>>6,h=63&s,isNaN(u)?f=h=64:isNaN(s)&&(h=64),p=p+e.charAt(l)+e.charAt(c)+e.charAt(f)+e.charAt(h);return n?p.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""):p},fromBase64:r,checkParam:function(e,r,n){if(!e)throw new Error(n);if(r&&t(e)!==r)throw new Error(n);return!0},getObjectType:t,bytesToHexString:function(e,r){var t="";void 0===r&&(r=!1);for(var n=0;n<e.length;n++){r&&n%4==0&&0!==n&&(t+="-");var o=e[n].toString(16).toUpperCase();1===o.length&&(t+="0"),t+=o}return t},bytesToInt32:function(e,r){return e[r=r||0]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]},stringToBytes:function(e){for(var r=[],t=0,n=0;t<e.length;t++){var o=e.charCodeAt(t);o<128?r[n++]=o:o<2048?(r[n++]=o>>>6|192,r[n++]=63&o|128):o<55296||o>57343?(r[n++]=o>>>12|224,r[n++]=o>>>6&63|128,r[n++]=63&o|128):(o=1024*(o-55296)+(e.charCodeAt(++t)-56320)+65536,r[n++]=o>>>18|240,r[n++]=o>>>12&63|128,r[n++]=o>>>6&63|128,r[n++]=63&o|128)}return r},bytesToString:function(e){var r,t="";e=o(e);for(var n=0;n<e.length;){var a=e[n++];if((r=a<128?a:a<224?(a<<6)+e[n++]-12416:a<240?(a<<12)+(e[n++]<<6)+e[n++]-925824:(a<<18)+(e[n++]<<12)+(e[n++]<<6)+e[n++]-63447168)>65535){var i=Math.floor((r-65536)/1024)+55296,u=(r-65536)%1024+56320;t+=String.fromCharCode(i,u)}else t+=String.fromCharCode(r)}return t},unpackData:function(e,t,n){var o,a=r(e),i=[];if(isNaN(t))return a;for(o=0;o<a.length;o+=t)i.push(a.slice(o,o+t));if(n)for(o=0;o<i.length;o++)i[o]=(i[o][0]<<24)+(i[o][1]<<16)+(i[o][2]<<8)+i[o][3];return i},hexToBytesArray:function(e){e=e.replace(/\-/g,"");for(var r=[];e.length>=2;)r.push(parseInt(e.substring(0,2),16)),e=e.substring(2,e.length);return r},int32ToBytes:n,int32ArrayToBytes:function(e){for(var r=[],t=0;t<e.length;t++)r=r.concat(n(e[t]));return r},toArray:o,arraysEqual:function(e,r){var t=!0;e.length!==r.length&&(t=!1);for(var n=0;n<e.length;n++)e[n]!==r[n]&&(t=!1);return t},clone:function(e){var r={};for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r},xorVectors:function(e,r,t){for(var n=Math.min(e.length,r.length),o=(t=t||new Array(n),0);o<n;o+=1)t[o]=e[o]^r[o];return t},padEnd:function(e,r,t){for(;e.length<t;)e.push(r);return e},padFront:function(e,r,t){for(;e.length<t;)e.unshift(r);return e},getVector:function(e,r){isNaN(r)&&(r=0);for(var t=new Array(e),n=0;n<e;n+=1)t[n]=r;return t},verifyByteArray:function(e){if("Array"!==t(e))return!1;for(var r,n=0;n<e.length;n++)if(r=e[n],isNaN(r)||r<0||r>255)return!1;return!0}}}(),c=(h={0:"CUSTOM",1:"BOOLEAN",2:"INTEGER",3:"BIT STRING",4:"OCTET STRING",5:"NULL",6:"OBJECT IDENTIFIER",16:"SEQUENCE",17:"SET",19:"PRINTABLE STRING",23:"UTCTime"},{parse:function e(r,t){t=!!t;var n,o,a,i=h[31&r[0]],u=r[1],s=0,l=!!(32&r[0]);if(128&u)for(s=0,u=0;s<(127&r[1]);s++)u=(u<<8)+r[2+s];if(a=2+s,void 0===i||u>r.length)return null;var c=l?[]:{};if(c.type=i,c.header=a,c.data=r.slice(0,u+a),l||t)for("BIT STRING"===c.type&&0===r[a]&&s++,n=r.slice(a,c.data.length);n.length>0&&null!==(o=e(n));)c.push(o),n=n.slice(o.data.length);return c},encode:function(e){throw new Error("not implemented")},toString:function(e){return function e(r,t){var n=new Array(t+1).join(" ")+r.type+" ("+r.length+") "+bytesToHexString(r.data).substring(0,16)+"\n";if(!r.children)return n;for(var o=0;o<r.children.length;o++)n+=e(r.children[o],t+4)+"";return n}(e,0)}}),f=function(){function e(e){return a&&o&&self.postMessage(e),e}return{jsCryptoRunner:function(t){t.data.workerid,t.data.operationType,t.data.operationSubType;var n=t.data.operationType,o=r[n][t.data.algorithm.name],a=t.data;if(!r.exists(n,t.data.algorithm.name))throw new Error("unregistered algorithm.");return a.operationSubType?e({type:a.operationSubType,result:o(a)}):e(o(a))},returnResult:e}}();var h;o&&(self.onmessage=function(e){if(!a&&e.data.prngSeed){var r=e.data.prngSeed;return R.init(r),a=!0,f.returnResult({initialized:!0})}!0===a&&f.jsCryptoRunner(e)});var g=function(){var e=l;function r(e){var r=e.algorithm.name.slice(0,3).toUpperCase();return"RSA"===r?"RSA":"ECD"===r?"EC":"oct"}function t(e){return e.hash.name.substring(e.hash.name.indexOf("-")+1)}var n={HMAC:function(e){return"HS"+t(e)},"AES-CBC":function(e){return"A"+e.length.toString()+"CBC"},"AES-GCM":function(e){return"A"+e.length.toString()+"GCM"},"RSAES-PKCS1-V1_5":function(e){return"RSA1_5"},"RSASSA-PKCS1-V1_5":function(e){return"RS"+t(e)},"RSA-OAEP":function(e){return"SHA-1"===e.hash.name.toUpperCase()?"RSA-OAEP":"RSA-OAEP-"+t(e)},"RSA-PSS":function(e){return"PS"+t(e)},ECDSA:function(e){return"EC-"+e.namedCurve.substring(e.namedCurve.indexOf("-")+1)}};return{keyToJwkOld:function(t,n){var o={};if(o.kty=r(t),o.extractable=t.extractable,n.pop)o.k=e.toBase64(n,!0);else for(var a in n)n[a].pop&&(o[a]=e.toBase64(n[a],!0));return t.algorithm.namedCurve&&(o.crv=t.algorithm.namedCurve),function(e){for(var r=[],t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return 0===r[r.length-1]&&r.pop(),r}(JSON.stringify(o,null,"\t"))},keyToJwk:function(t,o){var a={};if(a.kty=r(t),a.ext=t.extractable,n[t.algorithm.name.toUpperCase()]&&(a.alg=n[t.algorithm.name.toUpperCase()](t.algorithm)),a.key_ops=t.usages,o.pop)a.k=e.toBase64(o,!0);else for(var i in o)o[i].pop&&"key_ops"!==i&&(a[i]=e.toBase64(o[i],!0));return t.algorithm.namedCurve&&(a.crv=t.algorithm.namedCurve),a},jwkToKey:function(r,t,n){for(var o=JSON.parse(JSON.stringify(r)),a=0;a<n.length;a+=1){var i=o[n[a]];i&&(o[n[a]]=e.fromBase64(i))}return o}}}();var p=p||function(){for(var e=24,r=Math.floor(e/8),t=(1<<e)-1,n=1<<e,o=t,a=1/n,i=[1,256],u=2;u<=r;u++)i[u]=256*i[u-1];var s=[0],l=[1];function c(e){var r,t=null;if(arguments.length&&"number"!=typeof arguments[0]){if("object"==typeof arguments[0])for(t=new Array(e.length),r=0;r<e.length;r+=1)t[r]=e[r]}else for(t=new Array(e),r=0;r<e;r+=1)t[r]=0;return t}function f(e,r,t,n,o){for(;o-- >0;)t[n+o]=e[r+o]}function h(e){var r,t=0;for(r=0;r<e.length;r+=1)t|=e[r];return!t}function g(e){var t=Math.floor((e.length+r-1)/r),o=new Array(t);o[0]=0;for(var a=0,u=0,s=0,l=e.length-1;l>=0;l--)a+=i[s++]*(255&e[l]),i[s]===n&&(s=0,o[u++]=a,a=0);for(0!==a&&(o[u]=a);null==o[--t];)o[t]=0;return o}function y(r,t){if(void 0===t)if(r<=1)t=1;else{var o=Math.log(r)/Math.LN2;t=Math.ceil(o/e)}for(var a=[];r>0;)a.push(r%n),r=Math.floor(r/n);for(;a.length<t;)a.push(0);return a}function d(e){for(var r=e.length-1;r>=0;r--)if(void 0!==e[r]&&0!==e[r])return r;return 0===e[0]?-1:0}function m(e,r){var t,n,o=0;for(n=0;n<Math.max(e.length,r.length);n++)o=(t=~~e[n]-~~r[n])+(o&-!t);return o}function v(e,r,t){var n=d(e);if(e.length=r||n+1,t)for(;++n<e.length;)e[n]=0;return e.length<=0&&(e[0]=0,e.length=1),e}function w(r,n,o,a){if(void 0===o)o=1;else if(o>=e||o<0)throw new Error("bit count must be smaller than DIGIT_BITS and positive in shiftLeft");void 0===a&&(a=r.length);var i=e-o;n[a]=r[a-1]>>>e-o||n[a];for(var u=a-1;u>0;u--)n[u]=(r[u]<<o|r[u-1]>>>i)&t;n[0]=r[0]<<o&t}function k(r,n,o){var a=r,i=n;n.length<r.length&&(a=n,i=r);var u,s=a.length,l=0;for(u=0;u<s;u+=1)l+=a[u]+i[u],o[u]=l&t,l>>=e;for(u=s;u<i.length;u+=1)l+=i[u],o[u]=l&t,l>>=e;return o.length=i.length,0!==l&&(o[u]=l&t),l}function E(r,n,o){var a=n.length;if(r.length<n.length&&(a=d(n)+1,r.length<a))throw new Error("Subtrahend is longer than minuend, not supported.");var i,u=0;for(i=0;i<a;i+=1)u+=r[i]-n[i],o[i]=u&t,u>>=e;for(;i<r.length;)u+=r[i],o[i++]=u&t,u>>=e;return u}function b(e,r,n){r="number"==typeof r?[r]:r;var o,i,u,s,l,c,f,h,g=e.length,p=r.length;for(o=0;o<g+p;o+=1)n[o]=0;o=0,s=0;for(var y=0;o<p;){for(s=Math.min(s+31,p);o<s;o++)for(h=r[o],i=0;i<g;i++)n[o+i]+=e[i]*h;for(l=0,u=y;u<o+g;u++)f=(c=n[u]+l)&t,n[u]=f,l=(c-f)*a;n[u]=l,y+=31}return n.length=g+p,n}function S(r,o,a,i,u,s){var l,c,h,g,p,y,m,k=d(r)+1,E=d(o)+1;if(k<E)return f(r,0,i,0,r.length),i.length=r.length,v(i),a[0]=0,void(a.length=1);if(0===E||1===E&&0===o[E-1])throw new Error("Division by zero.");if(1===E){for(p=o[0],c=0,m=k-1;m>=0;m--)g=c*n+r[m],a[m]=g/p&t,c=g-a[m]*p&t;return a.length=k,v(a),i[0]=c,void(i.length=1)}var b=e-1-function(r){for(var t=0,n=0;n<e;n++)t=Math.max(t,-(r>>>n&1)&n);return t}(o[E-1]),S=u||[];S.length=E,w(o,S,b,E);var A=s||[];for(A.length=k,w(r,A,b,k),A[k]=A[k]||0,a.length=k-E+1,i.length=E,m=k-E;m>=0;m--){for(l=Math.floor((A[m+E]*n+A[m+E-1])/S[E-1]),c=A[m+E]*n+A[m+E-1]-l*S[E-1];(l>=n||l*S[E-2]>c*n+A[m+E-2])&&(l-=1,(c+=S[E-1])<n););for(h=0,y=0;y<E;y++)g=l*S[y],p=A[y+m]-h-(g&t),A[y+m]=p&t,h=Math.floor(g/n)-Math.floor(p/n);if(p=A[m+E]-h,A[m+E]=p&t,a[m]=l&t,p<0){for(a[m]=a[m]-1,h=0,y=0;y<E;y++)p=A[y+m]+S[y]+h,A[y+m]=p&t,h=p>>e;A[m+E]=A[m+E]+h&t}}for(y=0;y<E;y++)i[y]=(A[y]>>>b|A[y+1]<<e-b)&t;v(a),v(i)}function A(e,r,t,n,o){var a;if(h(e))return f(r,0,o,0,r.length),o.length=r.length,0;if(h(r))return f(e,0,o,0,e.length),o.length=e.length,0;m(e,r)<0?(a=e.slice(0),f(r,0,o,0,r.length),o.length=r.length):(a=r.slice(0),f(e,0,o,0,e.length),o.length=e.length),v(o),v(a);var i,u,s=new Array(o.length),l=new Array(o.length),c=new Array(o.length),g=void 0!==n;g&&((i=new Array(o.length))[0]=1,i.length=1,n[0]=0,n.length=1);var p=new Array(o.length),y=void 0!==t;y&&((u=new Array(o.length))[0]=0,u.length=1,t[0]=1,t.length=1);for(var d,w=-1,E=t,A=n,D=o;!h(a);)S(o,a,s,l,p,c),y&&(b(s,u,p),k(p,t,p),v(p),d=t,t=u,u=p,p=d),g&&(b(s,i,c),k(c,n,c),v(c),d=n,n=i,i=c,c=d),d=o,o=a,a=l,l=d,w++;return y&&(f(t,0,E,0,t.length),E.length=t.length),g&&(f(n,0,A,0,n.length),A.length=n.length),f(o,0,D,0,o.length),D.length=o.length,w}function D(e,r,t,n){if(n=n||[],0===m(r,s))n[0]=1;else if(0===m(r,l))f(e,0,n,0,e.length),n.length=e.length;else{var o=new T(t);v(e,o.s,!0),o.modExp(e,r,n),n.length=t.length}return n}function T(r,n){function o(r){for(var n=1,o=2,a=3,i=a&r,u=2;u<=e;u+=1)o<i&&(n+=o),o<<=1,i=r*n&(a=a<<1|1);return 1+(~n&t)}function i(e,r,n,o){for(var i,u,l,f,h,g,y,d,m=(o=o||this).m,v=m.length,w=o.mPrime,k=o.m0,E=0,b=0,S=c(v+2);E<v;){for(b=Math.min(v,b+16);E<b;){for(i=~~r[E],l=((u=S[0]+e[0]*i)&t)*w&t,S[1]+=(k*l+u)*a|0,f=1,h=0;f<v;h=f,f+=1)S[h]=S[f]+m[f]*l+e[f]*i;S[h]=S[f],S[f]=0,E++}for(d=0,f=0;f<v;f++)y=(g=S[f]+d)&t,S[f]=y,d=(g-y)*a;S[f]=d}for(E=0;E<v;E+=1)n[E]=S[E];n.length=v;var A=+(p.compareDigits(S,m)>0);p.subtract(n,m,o.temp2),s(A,n,o.temp2)}function u(e,r,t){var n,o,a,i,u;for(n=0;n<e[0].length;n++)t[n]=0;for(o=0;o<e.length;o++)for(i=e[o],a=-(r===o),u=0;u<i.length;u++)t[u]=t[u]|i[u]&a}function s(e,r,t){for(var n=-e,o=~n,a=0;a<r.length;a++)r[a]=r[a]&o|t[a]&n}var l=(n=n||function(e){var r=e.length,t=e[0],n={m:e,mPrime:o(t),m0:t,temp1:c(2*r+1),temp2:c(2*r+1)},a=c(2*e.length);a[a.length]=1,n.mu=[],S(a,e,n.mu,[]);var u=c(2*r+1),s=c(r+1),l=c(2*r+1),f=c(2*r+1),h=s;h[r]=1,S(h,e,u,s,l,f),n.rModM=v(s,r,!0);var g=c(2*r+1),p=g;return p[2*r]=1,S(p,e,u,g,l,f),n.rSquaredModm=v(g,r,!0),n.rCubedModm=c(r),i(g,g,n.rCubedModm,n),n}(r)).m,f=n.mu,h=n.m0,g=l.length,y=c(g+1).slice(0,g);y[0]=1;var d=n.mPrime,w=n.rModM,k=n.rSquaredModm,A=n.rCubedModm,D=c(2*g+1),T=c(2*g+1),C=new Array(4);return C[0]=w,C[1]=new Array(g),C[2]=new Array(g),C[3]=new Array(g),{m:l,m0:h,mPrime:d,mu:f,rSquaredModm:k,s:g,rModM:w,rCubedModm:A,one:y,temp1:D,temp2:T,convertToMontgomeryForm:function(e){if(e.length<this.s){e.length=this.s;for(var r=0;r<this.s;r++)e[r]=isNaN(e[r])?0:e[r]}var t=c(e.length);for(this.montgomeryMultiply(e,this.rSquaredModm,t),r=0;r<this.s;r+=1)e[r]=t[r]},convertToStandardForm:function(e){this.montgomeryMultiply(e,this.one,this.temp1);for(var r=0;r<this.s;r+=1)e[r]=this.temp1[r]},montgomeryMultiply:i,modExp:function(r,t,n,o){o=!!o;var a,i,s=function(r){var t,n,o=2,a=r*e;n=4+3*Math.ceil(a/2)+1;do{o++,t=n,n=Math.pow(2,o)+Math.ceil(a/o)*(o+1)+1}while(n<t);return o-1}(t.length),l=function(r,t){var n,o=r.length,a=(new Array(o*e),0),i=0,u=0,s=0,l=new Array(Math.ceil(o*e/t));for(u=0,l[0]=0;a<o;a++)for(i=0,n=r[a];i<e;i++,n>>>=1)u===t&&(l[++s]=0,u=0),l[s]+=(1&n)<<u++;return l}(t,s).reverse(),c=this.rModM.slice(0),f=Math.pow(2,s),h=C;for(h.length=f,h[0]=this.rModM,a=1;a<f;a++)h[a]=[],b(h[a-1],r,h[a]),this.reduce(h[a]);var g,p=[];for(a=0;a<l.length;a++){for(i=0;i<s;i++)this.montgomeryMultiply(c,c,c);g=l[a],o?p=h[g]:u(h,g,p),this.montgomeryMultiply(c,p,c)}return this.montgomeryMultiply(c,this.one,n),n},reduce:function(e,r){var t,n,o,a,i,u,c=this.m.length,f=[];for(r=r||e,t=[],b(e.slice(c-1),this.mu,t),n=t.slice(c+1),o=e.slice(0,c+1),b(n,l,a=[]),a=a.slice(0,c+1),o[c+1]=m(o,a)>>>31,i=0;i<r.length;i++)r[i]=0;E(o,a,r),u=+(m(r,l)>0),p.subtract(r,l,f),s(u,r,f),v(r)},ctx:n}}return{DIGIT_BITS:e,DIGIT_NUM_BYTES:r,DIGIT_MASK:t,DIGIT_BASE:n,DIGIT_MAX:o,Zero:s,One:l,normalizeDigitArray:v,bytesToDigits:g,stringToDigits:function(e,r){e=e.replace(/^\s+|\s+$/g,"");var t=[0],n=[0];r=r||10;for(var o=0;o<e.length;o+=1){var a=parseInt(e[o],r);if(isNaN(a))throw new Error("Failed to convert string to integer in radix "+r.toString());b(t,r,n),k(n,[a],t),v(t)}return t},digitsToString:function(e,r){if(n<=(r=r||10))throw new Error("DIGIT_BASE is smaller than RADIX; cannot convert.");var t,o=e.length,a=[],i=[],u=[],s=[],l=[],c=[],f="",h="0";for(l[0]=r;Math.floor(n/l[0])>=r;)l[0]=l[0]*r,h=h.concat("0");for(t=0;t<o;t+=1)c[t]=e[t];for(;;){var g=!0;for(t=0;t<c.length;t+=1)if(0!==c[t]){g=!1;break}if(g)break;S(c,l,a,i,u,s),v(a,c.length,!0);var p=i[0].toString(r);f=h.substring(0,h.length-p.length)+p+f;var y=c;c=a,a=y}for(;0!==f.length&&"0"===f[0];)f=f.substring(1,f.length);return 0===f.length&&(f="0"),f},intToDigits:y,digitsToBytes:function(e,t,n){var o,a,i,u=[0];for(void 0===t&&(t=!0),o=0;o<e.length;o+=1)for(i=e[o],a=0;a<r;a+=1)u[o*r+a]=255&i,i=Math.floor(i/256);if(u.reverse(),void 0===n&&(n=1),t)for(;u.length>n&&0===u[0];)u.shift();return u},isZero:h,isEven:function(e){return 0==(1&e[0])},shiftRight:function(r,n,o,a){if(void 0===o)o=1;else if(o>=e||o<0)throw new Error("Invalid bit count for shiftRight");void 0===a&&(a=r.length);for(var i=a-1,u=e-o,s=0;s<i;s++)n[s]=(r[s+1]<<u|r[s]>>>o)&t;n[i]=r[i]>>>o},shiftLeft:w,compareDigits:m,bitLength:function(e){for(var r=0,t=0;r<e.length;){if(0===t)for(var n=7;n>=0&&0===t;){var o=1<<n;(e[r]&o)===o&&(t=n+1),n--}else t+=8;r+=1}return t},fixedWindowRecode:function(e,r,t){e=e.slice();for(var n=[],o=Math.pow(2,r),a=Math.pow(2,r-1),i=0;i<t;i++)n[i]=e[0]%o-a,e[0]=e[0]-n[i],p.shiftRight(e,e,r-1);return n[i]=e[0],n},IntegerGroup:function(r){var n=g(r),o=n.length,a=y(0,o),i=y(1,o),u=c(o),s=c(o);function l(e,r){return{m_digits:e,m_group:r,equals:function(e){return 0===m(this.m_digits,e.m_digits)&&this.m_group.equals(this.m_group,e.m_group)}}}return{m_modulus:n,m_digitWidth:o,montmul:new T(n),createElementFromInteger:function(e){return l(y(e,this.m_digitWidth),this)},createElementFromBytes:function(e){var r=g(e);if(p.compareDigits(r,this.m_modulus)>=0)throw new Error("The number provided is not an element of this group");return v(r,this.m_digitWidth,!0),l(r,this)},createElementFromDigits:function(e){return p.normalizeDigitArray(e,this.m_digitWidth,!0),l(e,this)},equals:function(e){return 0===m(this.m_modulus,e.m_modulus)},add:function(r,n,o){var a,i=this.m_digitWidth,u=o.m_digits;p.add(r.m_digits,n.m_digits,u);var s=(m(u,this.m_modulus)>>>31)-1&t,l=0;for(a=0;a<i;a+=1)l=u[a]-(this.m_modulus[a]&s)+l,u[a]=l&t,l>>=e;u.length=i},subtract:function(r,n,o){var a,i=this.m_digitWidth,u=o.m_digits,s=p.subtract(r.m_digits,n.m_digits,o.m_digits);if(-1===s)for(s=0,a=0;a<i;a+=1)s+=u[a]+this.m_modulus[a],u[a]=s&t,s>>=e},multiply:function(e,r,t){return p.modMul(e.m_digits,r.m_digits,this.m_modulus,t.m_digits,u,s)},inverse:function(e,r){p.modInv(e.m_digits,this.m_modulus,r.m_digits)},modexp:function(e,r,t){if(t=t||l([],this),0===m(r,a))t.m_digits=y(1,this.m_digitWidth);else if(0===m(r,i)){for(var n=0;n<e.m_digits.length;n++)t.m_digits[n]=e.m_digits[n];t.m_digits.length=e.m_digits.length}else this.montmul.modExp(e.m_digits,r,t.m_digits),t.m_digits.length=this.montmul.s;return t}}},add:k,subtract:E,multiply:b,divRem:S,reduce:function(e,r,t,n,o){return S(e,r,[],t,n,o),t},modInv:function(e,r,t,n){var o=new Array(r.length),a=new Array(r.length),i=new Array(r.length),u=A(e,r,a,o,i);return t=t||[],0!==m(i,l)?(t[0]=NaN,t.length=1):(1==(1&u)?E(r,o,t):(f(o,0,t,0,o.length),t.length=o.length),n?v(t,r.length,!0):v(t)),t},modInvCT:function(e,r,t,n){var o=[];return t=t||[],E(r,[2],o),D(e,o,r,t),v(t),t},modExp:D,modMul:function(e,r,t,n,o,a){var i=[];return b(e,r,i),S(i,t,i,n,o,a),n},MontgomeryMultiplier:T,gcd:function(e,r,t){var n=e,o=r;return m(e,r)>0&&(n=r,o=e),A(n,o,void 0,void 0,t),v(t)},sequenceEqual:function(e,r){for(var t=e.length===r.length,n=0;n<Math.min(e.length,r.length);n+=1)e[n]!==r[n]&&(t=!1);return t},swapEndianness:function(e){return e.reverse()},computeBitArray:function(e){for(var r=c(8*e.length),t=0,n=e.length-1;n>=0;){for(var o=0;o<8;){var a=1<<o,i=(e[n]&a)===a?1:0,u=8*(e.length-n-1)+o;1===i&&(t=u+1),r[u]=i,o+=1}n--}return r.slice(0,t)}}}(),y=function(e,r,t,n,o,a,i){var u=l,s=t.slice(),c=new Array(o),f=[],h=0;function g(e){for(var r=Math.floor(e.length/o),t=0;t<r;t++)a(e,t,s,n,c);return h+=r,e.slice(r*o)}function p(){if(0!==g(function(e){var r=o-e.length%o;r<=o/8&&(r+=o);var t=u.getVector(r);t[0]=128;for(var n=8*(e.length+h*o),a=1;a<=8;a++)t[r-a]=n%256,n=Math.floor(n/256);return e.concat(t)}(f)).length)throw new Error("buffer.length !== 0");var e=function(){for(var e=[],r=0;r<s.length;r++)e=e.concat(u.int32ToBytes(s[r]));return e.length=i/8,e}();return f=[],s=t.slice(),h=0,e}return{name:e,computeHash:function(e){return f=g(e),p()},process:function(e){(f=f.concat(e)).length>=o&&(f=g(f))},finish:p,der:r,hashLen:i,maxMessageSize:4294967295}},d=function(){var e=l;function r(r,t,n,o,a){var i,u,s,l,c,f=n[0],h=n[1],g=n[2],p=n[3],y=n[4],d=n[5],m=n[6],v=n[7];for(u=0;u<16;u++)a[u]=e.bytesToInt32(r,64*t+4*u);for(i=16;i<64;i++)l=a[i-15],c=a[i-2],a[i]=((c>>>17|c<<15)^(c>>>19|c<<13)^c>>>10)+a[i-7]+((l>>>7|l<<25)^(l>>>18|l<<14)^l>>>3)+a[i-16],a[i]=4294967295&a[i];for(u=0;u<64;u++)p+=s=v+((y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7))+(y&d^~y&m)+o[u]+a[u],s+=((f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10))+(f&(h^g)^h&g),v=m,m=d,d=y,y=p,p=g,g=h,h=f,f=s;return n[0]=n[0]+f>>>0,n[1]=n[1]+h>>>0,n[2]=n[2]+g>>>0,n[3]=n[3]+p>>>0,n[4]=n[4]+y>>>0,n[5]=n[5]+d>>>0,n[6]=n[6]+m>>>0,n[7]=n[7]+v>>>0,n}var t,n,o,a,i,u=e.unpackData;return n=u("wQWe2DZ81QcwcN0X9w5ZOf/ACzFoWBURZPmPp776T6Q",4,1),o=u("agnmZ7tnroU8bvNypU/1OlEOUn+bBWiMH4PZq1vgzRk",4,1),t=u("QoovmHE3RJG1wPvP6bXbpTlWwltZ8RHxkj+CpKscXtXYB6qYEoNbASQxhb5VDH3Dcr5ddIDesf6b3AanwZvxdOSbacHvvkeGD8GdxiQMocwt6SxvSnSEqlywqdx2+YjamD5RUqgxxm2wAyfIv1l/x8bgC/PVp5FHBspjURQpKWcntwqFLhshOE0sbfxTOA0TZQpzVHZqCruBwskuknIshaK/6KGoGmZLwkuLcMdsUaPRkugZ1pkGJPQONYUQaqBwGaTBFh43bAgnSHdMNLC8tTkcDLNO2KpKW5zKT2gub/N0j4LueKVjb4TIeBSMxwIIkL7/+qRQbOu++aP3xnF48g",4,1),a=u("MC0wDQYJYIZIAWUDBAIEBQAEHA"),i=u("MDEwDQYJYIZIAWUDBAIBBQAEIA"),{sha224:function(){return y("SHA-224",a,n,t,64,r,224)},sha256:function(){return y("SHA-256",i,o,t,64,r,256)}}}();void 0!==r&&(d.instance224=d.instance224||d.sha224(),d.instance256=d.instance256||d.sha256(),d.instances={},d.getInstance224=function(e){return d.instances[e]||(d.instances[e]=d.sha224())},d.getInstance256=function(e){return d.instances[e]||(d.instances[e]=d.sha256())},d.deleteInstance=function(e){d.instances[e]=null,delete d.instances[e]},d.hash256=function(e){if("process"===e.operationSubType)return d.getInstance256(e.workerid).process(e.buffer),null;if("finish"===e.operationSubType){var r=d.getInstance256(e.workerid).finish();return d.deleteInstance(e.workerid),r}if("abort"!==e.operationSubType)return d.instance256.computeHash(e.buffer);d.deleteInstance(e.workerid)},d.hash224=function(e){if("process"!==e.operationSubType){if("finish"===e.operationSubType&&d.getInstance224(e.workerid).finish(),"abort"!==e.operationSubType)return d.instance224.computeHash(e.buffer);msrcryptoSha224.deleteInstance(e.workerid)}else d.getInstance224(e.workerid).process(e.buffer)},r.register("digest","SHA-224",d.hash224),r.register("digest","SHA-256",d.hash256)),s["SHA-224"]=d.sha224,s["SHA-256"]=d.sha256;var m=function(e,r){var t,n,o,a,i,u={384:128,512:128}[r.name.replace(/SHA-/,"")]||64,s=e.length===u?e:e.length>u?c(r.computeHash(e),u):c(e,u);function l(e,r){for(var t=new Array(e),n=0;n<e.length;n++)t[n]=e[n]^r[n];return t}function c(e,r){for(var t=e.slice(),n=e.length;n<r;n++)t.push(0);return t}function f(e){i?r.process(e):(i=a.concat(e),r.process(i))}function h(){var e=r.finish(),t=o.concat(e);return r.computeHash(t)}function g(){e=null,r=null,s=null}t=new Array(u),n=new Array(u);for(var p=0;p<u;p++)t[p]=54,n[p]=92;return a=l(s,t),o=l(s,n),{computeHmac:function(e,r,t){f(e);var n=h();return g(),n},process:function(e,r,t){return f(e),null},finish:function(e,r){var t=h();return g(),t}}};if(void 0!==r){var v={};m.signHmac=function(e){var r,t=e.keyHandle.algorithm.hash.name.toUpperCase(),n=s[t](),o=e.workerid;return v[o]||(v[o]=m(e.keyData,n)),"process"===e.operationSubType?(v[o].process(e.buffer),null):"finish"===e.operationSubType?(r=v[o].finish(),v[o]=null,r):(r=v[o].computeHmac(e.buffer),v[o]=null,r)},m.verifyHmac=function(e){var r,t=e.keyHandle.algorithm.hash.name.toUpperCase(),n=s[t](),o=e.workerid;return v[o]||(v[o]=m(e.keyData,n)),"process"===e.operationSubType?(v[o].process(e.buffer),null):"finish"===e.operationSubType?(r=v[o].finish(),r=l.arraysEqual(r,e.signature),v[o]=null,r):(r=v[o].computeHmac(e.buffer),r=l.arraysEqual(r,e.signature),v[o]=null,r)},m.generateKey=function(e){var r=e.algorithm.length;return r||(r={"SHA-1":64,"SHA-224":64,"SHA-256":64,"SHA-384":128,"SHA-512":128}[e.algorithm.hash.name.toUpperCase()]),{type:"keyGeneration",keyData:R.getBytes(r),keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"secret"}}},m.importKey=function(e){var r;if(e.keyData.length,"jwk"===e.format)(r=g.jwkToKey(e.keyData,e.algorithm,["k"])).alg=r.alg.replace("HS","SHA-");else{if("raw"!==e.format)throw new Error("unsupported import format");r={k:l.toArray(e.keyData)}}return{type:"keyImport",keyData:r.k,keyHandle:{algorithm:{name:"HMAC",hash:{name:e.algorithm.hash.name}},extractable:e.extractable||r.extractable,usages:e.usages,type:"secret"}}},m.exportKey=function(e){if("jwk"===e.format)return{type:"keyExport",keyHandle:g.keyToJwk(e.keyHandle,e.keyData)};if("raw"===e.format)return{type:"keyExport",keyHandle:e.keyData};throw new Error("unsupported export format")},r.register("importKey","HMAC",m.importKey),r.register("exportKey","HMAC",m.exportKey),r.register("generateKey","HMAC",m.generateKey),r.register("sign","HMAC",m.signHmac),r.register("verify","HMAC",m.verifyHmac)}var w,k,E,b,S,A,D,T,C,K,M={aes:function(e){var r,t,n,o;switch(w||(w=l.unpackData("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v0CjnoHz1/t84zmCmy//hzSOQ0TE3unLVHuUMqbCIz3uTJULQvrDTgguoWYo2SSydluiSW2L0SVy+PZkhmiYFtSkXMxdZbaSbHBIUP3tudpeFUZXp42dhJDYqwCMvNMK9+RYBbizRQbQLB6Pyj8PAsGvvQMBE4prOpERQU9n3OqX8s/O8LTmc5asdCLnrTWF4vk36Bx1325H8RpxHSnFiW+3Yg6qGL4b/FY+S8bSeSCa28D+eM1a9B/dqDOIB8cxsRIQWSeA7F9gUX+pGbVKDS3lep+TyZzvoOA7Ta4q9bDI67s8g1OZYRcrBH66d9Ym4WkUY1UhDH2NAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuN",256,!1),k=w[0],E=w[1],b=w[2],S=w[3],A=w[4],D=w[5],T=w[6],C=w[7],K=w[8]),r=8*e.length){case 128:case 192:case 256:break;default:throw new Error("Unsupported keyLength")}n=6+(t=r/32);var a=function(e){var r=e[1];e[1]=e[5],e[5]=e[9],e[9]=e[13],e[13]=r,r=e[2],e[2]=e[10],e[10]=r,r=e[6],e[6]=e[14],e[14]=r,r=e[15],e[15]=e[11],e[11]=e[7],e[7]=e[3],e[3]=r},i=function(e){var r=e[13];e[13]=e[9],e[9]=e[5],e[5]=e[1],e[1]=r,r=e[10],e[10]=e[2],e[2]=r,r=e[14],e[14]=e[6],e[6]=r,r=e[3],e[3]=e[7],e[7]=e[11],e[11]=e[15],e[15]=r},u=function(e){var r=e[0],t=e[1],n=e[2],o=e[3],a=e[4],i=e[5],u=e[6],s=e[7],l=e[8],c=e[9],f=e[10],h=e[11],g=e[12],p=e[13],y=e[14],d=e[15];e[0]=k[r]^E[t]^n^o,e[1]=r^k[t]^E[n]^o,e[2]=r^t^k[n]^E[o],e[3]=E[r]^t^n^k[o],e[4]=k[a]^E[i]^u^s,e[5]=a^k[i]^E[u]^s,e[6]=a^i^k[u]^E[s],e[7]=E[a]^i^u^k[s],e[8]=k[l]^E[c]^f^h,e[9]=l^k[c]^E[f]^h,e[10]=l^c^k[f]^E[h],e[11]=E[l]^c^f^k[h],e[12]=k[g]^E[p]^y^d,e[13]=g^k[p]^E[y]^d,e[14]=g^p^k[y]^E[d],e[15]=E[g]^p^y^k[d]},s=function(e){var r=e[0],t=e[1],n=e[2],o=e[3],a=e[4],i=e[5],u=e[6],s=e[7],l=e[8],c=e[9],f=e[10],h=e[11],g=e[12],p=e[13],y=e[14],d=e[15];e[0]=b[r]^A[t]^S[n]^D[o],e[1]=D[r]^b[t]^A[n]^S[o],e[2]=S[r]^D[t]^b[n]^A[o],e[3]=A[r]^S[t]^D[n]^b[o],e[4]=b[a]^A[i]^S[u]^D[s],e[5]=D[a]^b[i]^A[u]^S[s],e[6]=S[a]^D[i]^b[u]^A[s],e[7]=A[a]^S[i]^D[u]^b[s],e[8]=b[l]^A[c]^S[f]^D[h],e[9]=D[l]^b[c]^A[f]^S[h],e[10]=S[l]^D[c]^b[f]^A[h],e[11]=A[l]^S[c]^D[f]^b[h],e[12]=b[g]^A[p]^S[y]^D[d],e[13]=D[g]^b[p]^A[y]^S[d],e[14]=S[g]^D[p]^b[y]^A[d],e[15]=A[g]^S[p]^D[y]^b[d]},c=function(e,r){return[e[0]^r[0],e[1]^r[1],e[2]^r[2],e[3]^r[3]]},f=function(e,r,t){for(var n=0;n<e.length;n+=1)e[n]^=r[n+t]},h=function(e){for(var r=0;r<e.length;r+=1)e[r]=T[e[r]]},g=function(e){for(var r=0;r<e.length;r+=1)e[r]=C[e[r]]},p=function(e,r){return[e[4*r],e[4*r+1],e[4*r+2],e[4*r+3]]};return o=function(e){for(var r,o,a,i,u,s,l,f=[],g=0;g<4*t;)f.push(e[g++]);for(g=t;g<4*(n+1);){if(r=p(f,g-1),g%t==0){var y=[K[g/t],0,0,0];l=void 0,l=(s=r)[0],s[0]=s[1],s[1]=s[2],s[2]=s[3],s[3]=l,h(r),r=c(r,y)}else t>6&&g%t==4&&h(r);var d=c(p(f,g-t),r);a=d,u=0,(o=f)[4*(i=g)]=a[4*u],o[4*i+1]=a[4*u+1],o[4*i+2]=a[4*u+2],o[4*i+3]=a[4*u+3],g+=1}return f}(e),{encrypt:function(e){var r,t=e;for(f(t,o,0),r=1;r<=n-1;r+=1)h(t),a(t),u(t),f(t,o,4*r*4);return h(t),a(t),f(t,o,4*n*4),t},decrypt:function(e){var r,t=e;for(f(t,o,4*n*4),r=n-1;r>=1;r-=1)i(t),g(t),f(t,o,4*r*4),s(t);return i(t),g(t),f(t,o,0),t},clear:function(){},keyLength:r,blockSize:128}}},x=x||{};x.pkcsv7=function(e){return{pad:function(r){var t=r[r.length-1>=0?r.length-1:0],n=t.length;if(n===e){var o,a=[];for(o=0;o<e;o+=1)a.push(e);r.push(a)}else for(var i=e-n&255;t.length!==e;)t.push(i)},unpad:function(r){var t=!0;r.length%e!=0&&(t=!1);for(var n=r.slice(-e),o=n[n.length-1],a=0;a<e;a++){var i=e-a<=o,u=n[a]===o;t=(!i||u)&&t}var s=t?o:0;return r.length-=s,t}}};var I=function(e){var r=e.blockSize/8,t=x.pkcsv7(r),n=function(e){var r,t,n=[];for(r=0;r<e.length;r+=1){var o=e[r];for(t=0;t<o.length;t+=1)n.push(o[t])}return n};function o(e){var t=[];s=s.concat(e);for(var n=Math.floor(s.length/r),o=0;o<n;o++)t.push(s.slice(o*r,(o+1)*r));return s=s.slice(n*r),t}function a(r){for(var t,n=[],o=0;o<r.length;o++)t=l.xorVectors(u,r[o]),n.push(e.encrypt(t)),u=n[o];return n}function i(){s=[],c=[],u=null}var u,s=[],c=[];return{init:function(e){if(e.length!==r)throw new Error("Invalid iv size");u=e.slice()},encrypt:function(e){var r=a(o(e));return c=c.concat(n(r)),this.finishEncrypt()},processEncrypt:function(e){return n(a(o(e)))},finishEncrypt:function(){var e=1===s.length?[[s[0]]]:[s];t.pad(e);var r=c.concat(n(a(e)));return i(),r},decrypt:function(e){return this.processDecrypt(e),this.finishDecrypt()},processDecrypt:function(r){var t=function(r){for(var t,n,o=[],a=0;a<r.length;a+=1)t=r[a].slice(0,r[a].length),n=e.decrypt(t),o.push(l.xorVectors(u,n)),u=r[a];return o}(o(r));c=c.concat(n(t))},finishDecrypt:function(){var e=c;return t.unpad(e),i(),e}}};if(void 0!==r){var H={};I.workerEncrypt=function(e){var r,t=e.workerid;return H[t]||(H[t]=I(M.aes(e.keyData)),H[t].init(e.algorithm.iv)),"process"===e.operationSubType?H[t].processEncrypt(e.buffer):"finish"===e.operationSubType?(r=H[t].finishEncrypt(),H[t]=null,r):(r=H[t].encrypt(e.buffer),H[t]=null,r)},I.workerDecrypt=function(e){var r,t=e.workerid;if(H[t]||(H[t]=I(M.aes(e.keyData)),H[t].init(e.algorithm.iv)),"process"!==e.operationSubType)return"finish"===e.operationSubType?(r=H[t].finishDecrypt(),H[t]=null,r):(r=H[t].decrypt(e.buffer),H[t]=null,r);H[t].processDecrypt(e.buffer)},I.generateKey=function(e){if(e.algorithm.length%8!=0)throw new Error;return{type:"keyGeneration",keyData:R.getBytes(Math.floor(e.algorithm.length/8)),keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"secret"}}},I.importKey=function(e){var r,t=8*e.keyData.length;if("jwk"===e.format)r=g.jwkToKey(e.keyData,e.algorithm,["k"]);else{if("raw"!==e.format)throw new Error("unsupported import format");if(128!==t&&192!==t&&256!==t)throw new Error("invalid key length (should be 128, 192, or 256 bits)");r={k:l.toArray(e.keyData)}}return e.algorithm.length=8*r.k.length,{keyData:r.k,keyHandle:{algorithm:e.algorithm,extractable:e.extractable||r.extractable,usages:e.usages,type:"secret"},type:"keyImport"}},I.exportKey=function(e){if("jwk"===e.format)return{type:"keyExport",keyHandle:g.keyToJwk(e.keyHandle,e.keyData)};if("raw"===e.format)return{type:"keyExport",keyHandle:e.keyData};throw new Error("unsupported export format")},r.register("importKey","AES-CBC",I.importKey),r.register("exportKey","AES-CBC",I.exportKey),r.register("generateKey","AES-CBC",I.generateKey),r.register("encrypt","AES-CBC",I.workerEncrypt),r.register("decrypt","AES-CBC",I.workerDecrypt)}function B(){if(!(this instanceof B))throw new Error("create MsrcryptoPrng object with new keyword");var e,r,t,n,o=!1,a=1,i=Math.pow(2,48);function u(e){var r;for(r=e.length-1;r>=0&&(e[r]+=1,e[r]>=256&&(e[r]=0),!e[r]);r-=1);}function s(){e=l.getVector(32),r=l.getVector(16),t=32,n=48,a=1}function c(e,r){if((r=r||[0]).length>n)throw new Error("Incorrect entropy or additionalEntropy length");r=r.concat(l.getVector(n-r.length)),e=e.concat(l.getVector((n-e.length%n)%n));for(var t=0;t<e.length;t+=n)f(l.xorVectors(e.slice(t,t+n),r));a=1}function f(o){for(var a=[],i=new M.aes(e);a.length<n;){u(r);var s=r.slice(0,16),c=i.encrypt(s);a=a.concat(c)}a=l.xorVectors(a,o),e=a.slice(0,t),r=a.slice(t)}function h(t,o){if(t>=65536)throw new Error("too much random requested");if(a>i)throw new Error("Reseeding is required");if(o&&o.length>0){for(;o.length<n;)o=o.concat(l.getVector(n-o.length));f(o)}else o=l.getVector(n);for(var s=[],c=new M.aes(e);s.length<t;){u(r);var h=r.slice(0,r.length),g=c.encrypt(h);s=s.concat(g)}return s=s.slice(0,t),f(o),a+=1,s}return s(),{reseed:c,getBytes:function(e,r){if(!o)throw new Error("can't get randomness before initialization");return h(e,r)},getNonZeroBytes:function(e,r){if(!o)throw new Error("can't get randomness before initialization");for(var t,n=[];n.length<e;){t=h(e,r);for(var a=0;a<t.length;a+=1)0!==t[a]&&n.push(t[a])}return n.slice(0,e)},init:function(e,r){if(e.length<n)throw new Error("Initial entropy length too short");s(),c(e,r),o=!0}}}var R=new B;var P=function(){var e=[],r=[],t=16384;function n(t){var n,o=r.length;for(n=0;n<o;n++)if((r[n]+t)%e[n]==0)return!1;return!0}function o(n){var o,a,i,u,s,l,c=n.length-1,f=p.DIGIT_BASE,h=n[c];for(0===e.length&&(e=function(e){var r,t,n=new Array(e+1),o=[],a=0|Math.sqrt(e);for(r=3;r<=a;r+=2)for(t=r*r;t<=e;t+=2*r)n[t]=0;for(r=3;r<=e;r+=2)0!==n[r]&&o.push(r);return o}(t)),l=e.length,r=new Array(l),o=0;o<l;o++){for(a=c,h<(s=e[o])?(i=h,a--):i=0;a>=0;)i=(u=i*f+n[a--])-(u/s|0)*s;r[o]=i}}function a(e,r){var t=e,n=[];p.subtract(t,[1],n);var o=function(e){var r,t=0,n=0;if(p.isZero(e))return 0;for(t=0;0===e[t];t++);for(n=0,r=2;e[t]%r==0;r*=2,n++);return t*p.DIGIT_BITS+n}(n),a=[];p.shiftRight(n,a,o);for(var u,s=function(e){var r=0,t=0,n=0;if(p.isZero(e))return 0;for(r=e.length-1;0===e[r];r--);for(n=1<<(t=p.DIGIT_BITS-1);t>0&&0==(e[r]&n);n>>>=1,t--);return r*p.DIGIT_BITS+t}(t),l=p.MontgomeryMultiplier(t),c=1;c<=r;c++){var f=!1;do{u=i(s)}while(p.compareDigits(u,n)>=0);var h=[];if(l.modExp(u,a,h,!0),0!==p.compareDigits(h,[1])&&0!==p.compareDigits(h,n)){for(var g=1;g<o;g++){if(l.montgomeryMultiply(h,h,h),0===p.compareDigits(h,n)){f=!0;break}if(0===p.compareDigits(h,[1]))return!1}if(!1===f)return!1}}return!0}function i(e){var r=Math.ceil(e/8),t=R.getBytes(r);return t[0]|=128,t[t.length-1]|=1,p.bytesToDigits(t)}return{generatePrime:function(e){var r=i(e),t=0,u=[];for(o(r);;){if(n(t)&&(p.add(r,[t],u),!0===a(u,6)))return u;t+=2}}}}(),N=function(e){var r=l,t=e.hasOwnProperty("n")&&e.hasOwnProperty("d"),n=e.hasOwnProperty("p")&&e.hasOwnProperty("q"),o=e.n.length;function a(e){var t=p.digitsToBytes(e);return r.padFront(t,0,o),t}function i(e,r,t){var n=p.bytesToDigits(r),o=p.IntegerGroup(t),a=o.createElementFromBytes(e);return o.modexp(a,n).m_digits}return{encrypt:function(r){return a(i(r,e.e,e.n))},decrypt:function(r){if(n)return function(r){var t=p.bytesToDigits,n=e.p,o=e.q,i=e.dp,u=e.dq,s=e.qi,l=t(n),c=t(o),f=new Array(l.length+c.length),h=new Array(l.length+1),g=new Array(c.length+1),y=t(r),d=p.MontgomeryMultiplier,m=new d(e.ctxp?void 0:l,e.ctxp),v=new d(e.ctxq?void 0:c,e.ctxq);m.reduce(y,f),m.modExp(f,t(i),h),v.reduce(y,f),v.modExp(f,t(u),g);var w=p.subtract(h,g,f);return 0!==w&&p.subtract(g,h,f),p.modMul(f,t(s),l,y),0!==w&&p.subtract(l,y,y),p.multiply(y,c,f),p.add(g,f,h),a(h)}(r);if(t)return function(r){return a(i(r,e.d,e.n))}(r);throw new Error("missing private key")}}},O={mgf1:function(e,r,t){var n,o,a,i=[],u=t.hashLen/8;for(a=0;a<=Math.floor(r/u);a+=1)n=[a>>>24&255,a>>>16&255,a>>>8&255,255&a],o=t.computeHash(e.concat(n)),i=i.concat(o);return i.slice(0,r)},checkMessageVsMaxHash:function(e,r){if(e.length>(r.maxMessageSize||4294967295))throw new Error("message too long")}},L=L||{};L.oaep=function(e,r){var t=l,n=R,o=e.n.length;if(null===r)throw new Error("must supply hashFunction");return{pad:function(e,a){return function(e,a){var i,u,s,l,c,f,h,g,p;if(e.length>o-r.hashLen/8*2-2)throw new Error("Message too long.");return null==a&&(a=[]),i=r.computeHash(a),u=o-e.length-2*i.length-2,s=t.getVector(u),l=i.concat(s,[1],e),c=n.getBytes(i.length),f=O.mgf1(c,o-i.length-1,r),h=t.xorVectors(l,f),g=O.mgf1(h,i.length,r),p=t.xorVectors(c,g),e=[0].concat(p).concat(h).slice()}(e,a)},unpad:function(e,n){return function(e,n){var a,i,u,s,l,c,f,h,g=0,p=0===e[0];for(n||(n=[]),a=r.computeHash(n),i=e.slice(1,a.length+1),u=e.slice(a.length+1),s=O.mgf1(u,a.length,r),l=t.xorVectors(i,s),c=O.mgf1(l,o-a.length-1,r),h=(f=t.xorVectors(u,c)).slice(0,a.length),p=p&&t.arraysEqual(a,h),f=f.slice(a.length);!f[g++];);return{valid:p,data:f.slice(g)}}(e,n)}}};var q,_=function(e,r,t){var n=N(e);if(!r)throw new Error("padding mode");function o(){if(!t||!t.computeHash)throw new Error("missing hash function")}var a,i=null,u=null;switch(r){case"RSAES-PKCS1-V1_5":a=L.pkcs1Encrypt(e);break;case"RSASSA-PKCS1-V1_5":o(),a=L.pkcs1Sign(e,t);break;case"RSA-OAEP":o(),a=L.oaep(e,t);break;case"RSA-PSS":o(),a=L.pss(e,t);break;case"raw":a={pad:function(e){return e},unpad:function(e){return e}};break;default:throw new Error("invalid mode")}return a&&(i=a.pad||a.sign,u=a.unpad||a.verify),{encrypt:function(e,r){var t;return t=null!==i?i(e,r):e.slice(),n.encrypt(t)},decrypt:function(e,r){var t=n.decrypt(e);if(null!==u){if(!1===(t=u(t,r)).valid)throw new Error("OperationError");t=t.data}else t=t.slice(0);return t},signData:function(e,r,t){return n.decrypt(i(e,r,t))},verifySignature:function(e,r,t){var o=n.encrypt(e);return u(o,r,t)},generateKeyPair:function(e){genRsaKeyFromRandom(e)},mode:r}};void 0!==r&&(_.sign=function(e){var r=e.keyHandle.algorithm.hash.name,t=s[r.toUpperCase()](),n=e.algorithm.saltLength,o=e.algorithm.salt;return _(e.keyData,e.algorithm.name,t).signData(e.buffer,n,o)},_.verify=function(e){var r=e.keyHandle.algorithm.hash.name,t=s[r.toUpperCase()](),n=e.algorithm.saltLength;return _(e.keyData,e.algorithm.name,t).verifySignature(e.signature,e.buffer,n)},_.workerEncrypt=function(e){var r,t,n;switch(e.algorithm.name){case"RSAES-PKCS1-V1_5":r=_(e.keyData,e.algorithm.name).encrypt(e.buffer);break;case"RSA-OAEP":if(!(n=e.keyHandle.algorithm.hash.name))throw new Error("unsupported hash algorithm");t=s[n.toUpperCase()](),r=_(e.keyData,e.algorithm.name,t).encrypt(e.buffer);break;default:throw new Error("unsupported algorithm")}return r},_.workerDecrypt=function(e){var r,t;switch(e.algorithm.name){case"RSAES-PKCS1-V1_5":r=_(e.keyData,e.algorithm.name).decrypt(e.buffer);break;case"RSA-OAEP":var n=e.keyHandle.algorithm.hash.name;if(!n)throw new Error("unsupported hash algorithm");t=s[n.toUpperCase()](),r=_(e.keyData,e.algorithm.name,t).decrypt(e.buffer);break;default:throw new Error("unsupported algorithm")}return r},_.importKey=function(e){var r;if("jwk"===e.format)(r=g.jwkToKey(e.keyData,e.algorithm,["n","e","d","q","p","dq","dp","qi"])).d&&(r.ctxp=new p.MontgomeryMultiplier(p.bytesToDigits(r.p)).ctx,r.ctxq=new p.MontgomeryMultiplier(p.bytesToDigits(r.q)).ctx);else{if("spki"!==e.format)throw new Error("unsupported key import format.");var t=c.parse(e.keyData);if(null==t)throw new Error("invalid key data.");var n=t[1],o=c.parse(n.data.slice(n.header+1),!0);if(null==o)throw new Error("invalid key data.");var a=o[0],i=o[1];if("INTEGER"!==a.type||"INTEGER"!==i.type)throw new Error("invalid key data.");a=a.data.slice(a.header),i=i.data.slice(i.header),0===a[0]&&128&a[1]&&(a=a.slice(1)),0===i[0]&&128&i[1]&&(i=i.slice(1)),r={n:a,e:i}}return{type:"keyImport",keyData:r,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:r.d||r.dq?"private":"public"}}},_.exportKey=function(e){return"spki"===e.format?{type:"keyExport",keyHandle:Q.exportKeyToSpki(e)}:{type:"keyExport",keyHandle:g.keyToJwk(e.keyHandle,e.keyData)}},_.genRsaKeyFromRandom=function(e,r){var t=r?p.bytesToDigits(r):[65537];do{var n=P.generatePrime(e/2),o=P.generatePrime(e/2);if(p.compareDigits(o,n)>0){var a=n;n=o,o=a}var i=[];p.multiply(n,o,i);var u=[];p.subtract(n,[1],u);var s=[];p.subtract(o,[1],s);var l=[];p.multiply(u,s,l);var c=[];p.gcd(t,l,c);var f=0===p.compareDigits(c,p.One)}while(!f);var h=[];p.modInv(t,l,h);var g=[];p.reduce(h,u,g);var y=[];p.reduce(h,s,y);var d=[];p.modInv(o,n,d);var m=p.digitsToBytes;return{privateKey:{n:m(i),e:m(t),d:m(h),p:m(n),q:m(o),dp:m(g),dq:m(y),qi:m(d)},publicKey:{n:m(i),e:m(t)}}},_.generateKeyPair=function(e){if(void 0===e.algorithm.modulusLength)throw new Error("missing modulusLength");var r,t=p.bytesToDigits;switch(e.algorithm.modulusLength){case 1024:case 2048:case 4096:r=_.genRsaKeyFromRandom(e.algorithm.modulusLength,e.algorithm.publicExponent);break;default:throw new Error("invalid modulusLength")}var n=r.privateKey;n.ctxp=new p.MontgomeryMultiplier(t(n.p)).ctx,n.ctxq=new p.MontgomeryMultiplier(t(n.q)).ctx;var o,a,i=e.algorithm.name;return i.slice(i.indexOf("-")+1).toUpperCase(),"RSASSA-PKCS1-V1_5"===i||"RSA-PSS"===i?(o=["verify"],a=["sign"]):(o=["encrypt"],a=["decrypt"]),{type:"keyGeneration",keyPair:{publicKey:{keyData:r.publicKey,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:o,type:"public"}},privateKey:{keyData:r.privateKey,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:a,type:"private"}}}}},r.register("sign","RSASSA-PKCS1-V1_5",_.sign),r.register("sign","RSA-PSS",_.sign),r.register("verify","RSASSA-PKCS1-V1_5",_.verify),r.register("verify","RSA-PSS",_.verify),r.register("encrypt","RSAES-PKCS1-V1_5",_.workerEncrypt),r.register("decrypt","RSAES-PKCS1-V1_5",_.workerDecrypt),r.register("encrypt","RSA-OAEP",_.workerEncrypt),r.register("decrypt","RSA-OAEP",_.workerDecrypt),r.register("importKey","RSA-OAEP",_.importKey),r.register("importKey","RSAES-PKCS1-V1_5",_.importKey),r.register("importKey","RSASSA-PKCS1-V1_5",_.importKey),r.register("importKey","RSA-PSS",_.importKey),r.register("exportKey","RSA-OAEP",_.exportKey),r.register("exportKey","RSAES-PKCS1-V1_5",_.exportKey),r.register("exportKey","RSASSA-PKCS1-V1_5",_.exportKey),r.register("exportKey","RSA-PSS",_.exportKey),r.register("generateKey","RSA-OAEP",_.generateKeyPair),r.register("generateKey","RSAES-PKCS1-V1_5",_.generateKeyPair),r.register("generateKey","RSASSA-PKCS1-V1_5",_.generateKeyPair),r.register("generateKey","RSA-PSS",_.generateKeyPair));var U=l;q=function(){function e(){var e;return{postMessage:function(r){try{r.workerid=this.id,e=f.jsCryptoRunner({data:r})}catch(e){return void this.onerror({data:e,type:"error"})}this.onmessage({data:e})},onmessage:null,onerror:null,terminate:function(){}}}var o=function(e){return{process:function(r){return e.process(r)},finish:function(){return e.finish()},abort:function(){return e.abort()}}};function a(e){var r,t,n;return{dispatchEvent:function(o){"error"!==o.type?"process"!==o.data.type&&"finish"!==o.data.type?(this.result=e(o.data),t.apply(r,[this.result])):e(o.data.result,!0):n&&n.apply(r,[o])},promise:r=new Promise(function(e,r){t=e,n=r}),result:null}}function s(e){var r=[],t=a(function(e,t){var n;if(e=e&&(n=e,i&&n.pop?new Uint8Array(n).buffer:n),!t)return e;r.resolve(e)});return t.stream=e.algorithm.stream,r.add=function(e){var t,n,o=new Promise(function(e,r){t=e,n=r});return o.label=e,r.push({resolve:t,reject:n,promise:o}),o},r.resolve=function(e){var t=r.shift();t.resolve.apply(t.promise,[e])},t.process=function(t){return e.operationSubType="process",e.buffer=U.toArray(t),h.continueJob(this,U.clone(e)),r.add("process")},t.finish=function(){return e.operationSubType="finish",e.buffer=[],h.continueJob(this,U.clone(e)),r.add("finish")},t.abort=function(){h.abortJob(this)},t.algorithm=e.algorithm||null,t.key=e.keyHandle||null,t}var c=[];c.add=function(e,r){c.push({keyHandle:e,keyData:r})},c.remove=function(e){for(var r=0;r<c.length;r+=1)if(c[r].keyHandle===e)return void(c=c.splice(r,1))},c.lookup=function(e){for(var r=0;r<c.length;r+=1)if(c[r].keyHandle===e)return c[r].keyData;return null};var h=function(){var r=12,o=2,a=[],i=[],s=0,l=0,c=[],f="undefined"==typeof setImmediate?setTimeout:setImmediate;function h(){c.shift()()}var g=n?"available":"unavailable";function p(){!function(e){for(var r=a.length-1;r>=0;r-=1)a[r].isWebWorker===e&&(a[r].terminate(),a.splice(r,1))}(!u);for(var e=0;e<a.length;e++)if(!a[e].busy)return a[e];return null}function y(e){for(var r=0;r<a.length;r++)if(a[r]===e)return e.terminate(),void a.splice(r,1)}function d(e){for(var r=0;r<a.length;r++)if(a[r].operation===e)return a[r];return null}function m(e,r){i.push({operation:e,data:r,id:s++})}function v(e){if(e.busy=!1,u)if(i.length>0){var r,t=i.shift();if(E(t.operation,t.data),"process"===t.data.operationSubType){for(r=0;r<i.length;r++)t.operation===i[r].operation&&E(i[r].operation,i[r].data);for(r=i.length-1;r>=0;r--)t.operation===i[r].operation&&i.splice(r,1)}}else(function(){for(var e=0,r=0;r<a.length;r++)a[r].busy||(e+=1);return e})()>o&&y(e)}function w(r){var n;if("pending"===g)throw new Error("Creating new worker while workerstatus=pending");if("ready"===g)try{(n=new Worker(t)).postMessage({prngSeed:R.getBytes(48)}),n.isWebWorker=!0}catch(r){u=!1,g="failed",n.terminate(),(n=e()).isWebWorker=!1}else(n=e()).isWebWorker=!1;return n.operation=r,n.id=l++,n.busy=!1,n.onmessage=function(e){if(!0!==e.data.initialized){var r=n.operation;e.target||(e.target={data:n.data});for(var t=0;t<i.length;t++)if(i[t].operation===n.operation){var o=i[t];return i.splice(t,1),void b(n,o.data)}e.data.hasOwnProperty("type")&&"process"===e.data.type||v(n),r.dispatchEvent(e)}},n.onerror=function(e){var r=n.operation;v(n),r.dispatchEvent(e)},function(e){a.push(e)}(n),n}function k(e,t){var n=null;if("pending"!==g)if(n=p(),u&&null===n&&a.length>=r)m(e,t);else{if(null===n&&(n=w(e)),null===n)throw m(e,t),new Error("could not create new worker");n.operation=e,n.busy=!0,t.workerid=n.id,b(n,t)}else m(e,t)}function E(e,r){var t=d(e);t?b(t,r):k(e,r)}function b(e,r){if(r.workerid=e.id,u)e.postMessage(r);else{var t=(o=r,function(){return e.postMessage(o)});n=t,c.push(n),f(h,0)}var n,o}return{runJob:k,continueJob:E,abortJob:function(e){var r=d(e);r&&y(r)},useWebWorkers:function(e){if("unavailable"!==g){if(!(!0===e&&"ready"===g||!1===e&&"available"===g)){if(!1===e&&"ready"===g)return u=!1,g="available",void U.consoleLog("web workers disabled.");if("pending"!==g){g="pending";var r=new Worker(t);r.addEventListener("message",n,!1),r.addEventListener("error",n,!1),r.postMessage({prngSeed:R.getBytes(48)})}}}else U.consoleLog("web workers not available in this browser.");function n(e){var t=!(!e.data||!0!==e.data.initialized);if(r.removeEventListener("message",n,!1),r.removeEventListener("error",n,!1),r.terminate(),g=t?"ready":"failed",u=t,U.consoleLog("web worker initialization "+(t?"succeeded. Now using web workers.":"failed. running synchronously."+(e.message||""))),i.length>0){var o=i.shift();k(o.operation,o.data)}}}}}(),g=[{name:"algorithm",type:"Object",required:!0},{name:"keyHandle",type:"Object",required:!0},{name:"buffer",type:"Array",required:!1},{name:"signature",type:"Array",required:!0},{name:"format",type:"String",required:!0},{name:"keyData",type:"Object",required:!0},{name:"extractable",type:"Boolean",required:!1},{name:"usages",type:"Array",required:!1},{name:"derivedKeyType",type:"Object",required:!0},{name:"length",type:"Number",required:!1},{name:"extractable",type:"Boolean",required:!0},{name:"usages",type:"Array",required:!0},{name:"keyData",type:"Array",required:!0}],p={encrypt:[0,1,2],decrypt:[0,1,2],sign:[0,1,2],verify:[0,1,3,2],digest:[0,2],generateKey:[0,6,7],importKeyRaw:[4,12,0,10,11],importKeyJwk:[4,5,0,10,11],exportKey:[0,4,1,6,7],deriveKey:[0,1,8,6,7],deriveBits:[0,1,9],wrapKey:[1,1,0],unwrapKey:[2,0,1,6,7]};function y(e){var r=c.lookup(e);if(!r)throw new Error("key not found");return r}function d(e,t,n){var i=function(e,r){var t,n,o,a,i={operationType:e};for("importKey"!==e||"raw"!==r[0]&&"spki"!==r[0]||(e="importKeyRaw"),"importKey"===e&&"jwk"===r[0]&&(e="importKeyJwk"),t=p[e],a=0;a<t.length;a+=1)if(n=g[t[a]],null!=(o=r[a])){if(o.subarray&&(o=U.toArray(o)),"ArrayBuffer"===U.getObjectType(o)&&(o=U.toArray(o)),l.getObjectType(o)!==n.type)throw new Error(n.name);"algorithm"===n.name&&(o.name=o.name.toUpperCase(),o.iv&&(o.iv=U.toArray(o.iv)),o.publicExponent&&(o.publicExponent=U.toArray(o.publicExponent)),o.salt&&(o.salt=U.toArray(o.salt)),o.additionalData&&(o.additionalData=U.toArray(o.additionalData)),o.hash&&!o.hash.name&&"String"===U.getObjectType(o.hash)&&(o.hash={name:o.hash})),i.hasOwnProperty(n.name)?i[n.name+"1"]=o:i[n.name]=o}else if(n.required)throw new Error(n.name);return i}(e,t);!function(e,t){if(!r.exists(e,t))throw new Error("unsupported algorithm")}(e,i.algorithm.name),i.keyHandle&&(i.keyData=y(i.keyHandle)),i.keyHandle1&&(i.keyData1=y(i.keyHandle1)),i.algorithm&&i.algorithm.public&&(i.additionalKeyData=y(i.algorithm.public));var u=n?a(function(e){var r,t;switch(e.type){case"keyGeneration":case"keyImport":case"keyDerive":return e.keyPair?(c.add(e.keyPair.publicKey.keyHandle,e.keyPair.publicKey.keyData),c.add(e.keyPair.privateKey.keyHandle,e.keyPair.privateKey.keyData),{publicKey:e.keyPair.publicKey.keyHandle,privateKey:e.keyPair.privateKey.keyHandle}):(c.add(e.keyHandle,e.keyData),e.keyHandle);case"keyExport":return e.keyHandle;case"keyPairGeneration":return t=e.keyPair.privateKey,r=e.keyPair.publicKey,c.add(r.keyHandle,r.keyData),c.add(t.keyHandle,t.keyData),{publicKey:r.keyHandle,privateKey:t.keyHandle};default:throw new Error("Unknown key operation")}}):s(i);return(n||i.buffer||"deriveBits"===e||"wrapKey"===e)&&h.runJob(u,i),u.stream?Promise.resolve(o(u)):u.promise}return{publicMethods:{encrypt:function(e,r,t){return d("encrypt",arguments,0)},decrypt:function(e,r,t){return d("decrypt",arguments,0)},sign:function(e,r,t){return d("sign",arguments,0)},verify:function(e,r,t,n){return d("verify",arguments,0)},digest:function(e,r){return d("digest",arguments,0)},generateKey:function(e,r,t){return d("generateKey",arguments,1)},deriveKey:function(e,r,t,n,o){var a=this.deriveBits,i=this.importKey;return new Promise(function(u,s){var l;switch(t.name.toUpperCase()){case"AES-CBC":case"AES-GCM":l=t.length;break;case"HMAC":l=t.length||{"SHA-1":512,"SHA-224":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[t.hash.name.toUpperCase()];break;default:return void s(new Error("No Supported"))}a(e,r,l).then(function(e){return i("raw",e,t,n,o)}).then(function(e){u(e)})["catch"](function(e){s(e)})})},deriveBits:function(e,r,t){return d("deriveBits",arguments,0)},importKey:function(e,r,t,n,o){return d("importKey",arguments,1)},exportKey:function(e,r){return d("exportKey",[r.algorithm,e,r],1)},wrapKey:function(e,r,t,n){var o=this.encrypt,a=this.exportKey;return new Promise(function(i,u){!1===r.extractable||r.usages.indexOf("wrapKey")<0||t.algorithm.name.toUpperCase()!==n.name?u(new Error("InvalidAccessError")):a(e,r).then(function(r){return o(n,t,"jwk"===e?U.stringToBytes(JSON.stringify(r,null,0)):r)}).then(function(e){i(e)})["catch"](function(e){u(e)})})},unwrapKey:function(e,r,t,n,o,a,i){var u=this.decrypt,s=this.importKey;return new Promise(function(l,c){t.usages.indexOf("unwrapKey")<0||t.algorithm.name.toUpperCase()!==n.name?c(new Error("InvalidAccessError")):u(n,t,r).then(function(r){return s(e,"jwk"===e?JSON.parse(U.bytesToString(r)):r,o,a,i)}).then(function(e){l(e)})["catch"](function(e){c(e)})})}},internalMethods:{useWebWorkers:h.useWebWorkers}}}();var W,Q=function(){var e={INTEGER:2,BITSTRING:3,OBJECTIDENTIFIER:6,SEQUENCE:48},r={NEED_FLAG_LEN:128,ONE_BYTE_LEN_FLAG:129,TWO_BYTE_LEN_FLAG:130},t=[48,13,6,9,42,134,72,134,247,13,1,1,1,5,0];function n(e){return e>255?[r.TWO_BYTE_LEN_FLAG,e>>8&255,255&e]:e>=r.NEED_FLAG_LEN?[r.ONE_BYTE_LEN_FLAG,e]:[e]}function o(e){return e[0]>>7?[0].concat(e):e}return{exportKeyToSpki:function(r){var a=o(r.keyData.n),i=o(r.keyData.e),u=[].concat(e.INTEGER,n(a.length),a),s=[].concat(e.INTEGER,n(i.length),i),l=[].concat(e.SEQUENCE,n(u.length+s.length),u,s),c=[].concat(e.BITSTRING,n(l.length+1),[0],l),f=[].concat(e.SEQUENCE,n(t.length+c.length),t,c);return new Uint8Array(f).buffer}}}(),V={subtle:q?q.publicMethods:null,getRandomValues:function(e){var r,t=R.getBytes(e.length);for(r=0;r<e.length;r+=1)e[r]=t[r];return e},initPrng:function(e){var r=Object.prototype.toString.call(e);if("[object Array]"!==r&&"[object Uint8Array]"!==r)throw new Error("entropyData must be a Array or Uint8Array");W&&W.reseed(e),R.reseed(W.read(48))},toBase64:function(e,r){return l.toBase64(e,r)},fromBase64:function(e){return l.fromBase64(e)},textToBytes:function(e){return l.stringToBytes(e)},bytesToText:function(e){return l.bytesToString(e)},asn1:c,url:t,version:msrCryptoVersion,useWebWorkers:function(e){return q?q.internalMethods.useWebWorkers(e):null}};(W=W||new function(e){var r=48,t=[],n=128,o=new B,a=!1,i=!1,u=e;function s(){var n,s=["Cookie","RedirectUri","ETag","x-ms-client-antiforgery-id","x-ms-client-request-id","x-ms-client-session-id","SubscriptionPool"],c=[];for(n=0;n<r;n+=1)c[n]=Math.floor(256*Math.random());var g=u.crypto||u.msCrypto;if(g&&"function"==typeof g.getRandomValues&&e.Uint8Array){var p=new e.Uint8Array(r);g.getRandomValues(p),c=c.concat(Array.apply(null,p)),i=!0}if("undefined"!=typeof XMLHttpRequest){var y=new XMLHttpRequest;for(n=0;n<s.length;n+=1)try{var d=y.getResponseHeader(s[n]);if(d){var m=l.stringToBytes(d);c=c.concat(m)}}catch(e){}}!i&&f&&(c=c.concat(t.splice(0,t.length)),h.startCollectors()),a?o.reseed(c):o.init(c),a=!0}function c(e){for(var r=0;r<e.length;++r)t.push(e[r]);t.length>=n&&h.stopCollectors()}var f=e&&e.addEventListener||"undefined"!=typeof document&&document.attachEvent,h={startCollectors:function(){if(!this.collectorsRegistered){if(e.addEventListener)e.addEventListener("mousemove",this.MouseEventCallBack,!0),e.addEventListener("load",this.LoadTimeCallBack,!0);else{if(!document.attachEvent)throw new Error("Can't attach events for entropy collection");document.attachEvent("onmousemove",this.MouseEventCallBack),document.attachEvent("onload",this.LoadTimeCallBack)}this.collectorsRegistered=1}},stopCollectors:function(){this.collectorsRegistered&&(e.removeEventListener?(e.removeEventListener("mousemove",this.MouseEventCallBack,1),e.removeEventListener("load",this.LoadTimeCallBack,1)):e.detachEvent&&(e.detachEvent("onmousemove",this.MouseEventCallBack),e.detachEvent("onload",this.LoadTimeCallBack)),this.collectorsRegistered=0)},MouseEventCallBack:function(e){var r=(new Date).valueOf(),t=e.x||e.clientX||e.offsetX||0,n=e.y||e.clientY||e.offsetY||0;c([255&r,r>>8&255,r>>16&255,r>>24&255,255&t,t>>8&255,255&n,n>>8&255])},LoadTimeCallBack:function(){var e=(new Date).valueOf();c([255&e,e>>8&255,e>>16&255,e>>24&255])}};return{init:function(){if(s(),!i&&f)try{h.startCollectors()}catch(e){}},reseed:function(e){o.reseed(e)},read:function(e){if(!a)throw new Error("Entropy pool is not initialized.");var r=o.getBytes(e);return s(),r}}}(e)).init();var j=W.read(48);return R.init(j),V}()});